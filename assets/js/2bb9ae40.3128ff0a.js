(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[9966],{3905:function(e,n,t){"use strict";t.d(n,{Zo:function(){return $},kt:function(){return m}});var i=t(7294);function a(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function r(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,i)}return t}function d(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?r(Object(t),!0).forEach((function(n){a(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):r(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function s(e,n){if(null==e)return{};var t,i,a=function(e,n){if(null==e)return{};var t,i,a={},r=Object.keys(e);for(i=0;i<r.length;i++)t=r[i],n.indexOf(t)>=0||(a[t]=e[t]);return a}(e,n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(i=0;i<r.length;i++)t=r[i],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}var c=i.createContext({}),o=function(e){var n=i.useContext(c),t=n;return e&&(t="function"==typeof e?e(n):d(d({},n),e)),t},$=function(e){var n=o(e.components);return i.createElement(c.Provider,{value:n},e.children)},l={inlineCode:"code",wrapper:function(e){var n=e.children;return i.createElement(i.Fragment,{},n)}},p=i.forwardRef((function(e,n){var t=e.components,a=e.mdxType,r=e.originalType,c=e.parentName,$=s(e,["components","mdxType","originalType","parentName"]),p=o(t),m=a,u=p["".concat(c,".").concat(m)]||p[m]||l[m]||r;return t?i.createElement(u,d(d({ref:n},$),{},{components:t})):i.createElement(u,d({ref:n},$))}));function m(e,n){var t=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var r=t.length,d=new Array(r);d[0]=p;var s={};for(var c in n)hasOwnProperty.call(n,c)&&(s[c]=n[c]);s.originalType=e,s.mdxType="string"==typeof e?e:a,d[1]=s;for(var o=2;o<r;o++)d[o]=t[o];return i.createElement.apply(null,d)}return i.createElement.apply(null,t)}p.displayName="MDXCreateElement"},2158:function(e,n,t){"use strict";t.r(n),t.d(n,{frontMatter:function(){return s},contentTitle:function(){return c},metadata:function(){return o},toc:function(){return $},default:function(){return p}});var i=t(2122),a=t(9756),r=(t(7294),t(3905)),d=["components"],s={sidebar_position:2,title:"Main CC"},c=void 0,o={unversionedId:"giveaway/compressed/main-cc",id:"giveaway/compressed/main-cc",isDocsHomePage:!1,title:"Main CC",description:"Trigger Type: Command",source:"@site/docs/giveaway/compressed/main-cc.md",sourceDirName:"giveaway/compressed",slug:"/giveaway/compressed/main-cc",permalink:"/giveaway/compressed/main-cc",editUrl:"https://github.com/yagpdb-cc/yagpdb-cc/edit/master/website/docs/giveaway/compressed/main-cc.md",version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2,title:"Main CC"},sidebar:"tutorialSidebar",previous:{title:"Overview",permalink:"/giveaway/compressed/overview"},next:{title:"Reaction Handler",permalink:"/giveaway/compressed/reaction-handler"}},$=[],l={toc:$};function p(e){var n=e.components,t=(0,a.Z)(e,d);return(0,r.kt)("wrapper",(0,i.Z)({},l,t,{components:n,mdxType:"MDXLayout"}),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Trigger Type:")," ",(0,r.kt)("inlineCode",{parentName:"p"},"Command")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Trigger:")," ",(0,r.kt)("inlineCode",{parentName:"p"},"giveaway")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Usage:"),(0,r.kt)("br",{parentName:"p"}),"\n","Read the ",(0,r.kt)("a",{parentName:"p",href:"/giveaway/compressed/overview"},"README")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-go"},'{{$gEmoji:=`<:yag:277569741932068864>`}}\n\n{{/*Code*/}}\n{{$rEmoji:=reReplace `\\A<|>\\z` $gEmoji ""}}\n{{$syntaxError:=0}}{{$CmdArgs:=cslice}}{{$StrippedMsg:=""}}{{$Cmd:=""}}{{$ExecData:=0}}\n{{if not .ExecData}}{{$CmdArgs =.CmdArgs}}{{$StrippedMsg =reReplace `\\A\\s+|\\s+\\z` .StrippedMsg ""}}{{$Cmd =.Cmd}}\n{{else if toInt .ExecData}}{{$ExecData =str .ExecData}}\n{{else if eq (printf "%T" .ExecData) "string"}}\n{{$args:=split .ExecData " "}}\n{{if gt (len $args) 1}}\n{{$StrippedMsg =reReplace `\\A\\s+|\\s+\\z` (joinStr " " (slice $args 1)) ""}}\n{{$Cmd =index $args 0}}{{range reFindAllSubmatches `\\x60(|.*?[^\\\\])\\x60|"(|.*?[^\\\\])"|(\\S+)` $StrippedMsg}}{{$CmdArgs =$CmdArgs.Append (or (index . 1) (index . 2) (index . 3))}}{{end}}{{$CmdArgs =$CmdArgs.StringSlice}}\n{{end}}\n{{end}}\n\n{{if not $ExecData}}\n\n{{if gt (len $CmdArgs) 0}}\n{{$subCmd:=lower (index $CmdArgs 0)}}\n{{if or (gt (len $CmdArgs) 1) (eq $subCmd "list") (eq $subCmd "reroll")}}\n\n{{if eq $subCmd "start"}}\n\n{{$CmdArgs:=reReplace (print `(?i)\\A` $subCmd `\\s*`) $StrippedMsg ""}}\n{{$maxP:=-1}}{{$maxW:=1}}{{$chan:=.Channel.ID}}{{$ID:=""}}\n{{$uID:=toInt (currentTime.Sub (newDate 2019 10 10 0 0 0)).Seconds}}\n\n{{with reFindAllSubmatches `(?i)-w (\\d+)(?:\\s+|\\z)` $CmdArgs}}{{$CmdArgs =reReplace (index . 0 0) $CmdArgs ""}}{{$maxW =toInt (index . 0 1)}}{{end}}\n{{with reFindAllSubmatches `(?i)-p (\\d+)(?:\\s+|\\z)` $CmdArgs}}{{$CmdArgs =reReplace (index . 0 0) $CmdArgs ""}}{{$maxP =toInt (index . 0 1)}}{{end}}\n{{with reFindAllSubmatches `(?i)(-c (?:<#)?(\\d+)>?(?:\\s+|$))` $CmdArgs}}{{$CmdArgs =reReplace (index . 0 0) $CmdArgs ""}}{{$chan =index . 0 2}}{{end}}\n\n{{$temp:=split $CmdArgs " "}}{{$duration:=toDuration (index $temp 0)}}{{$prize:=""}}\n{{if gt (len $temp) 1}}{{$prize =joinStr " " (slice $temp 1)}}{{end}}\n{{$prize =reReplace `\\A\\s+|\\s+\\z` $prize ""}}\n\n{{if and $duration $prize}}\n\n{{if or (ge $maxP $maxW) (eq $maxP -1)}}\n\n{{with sendMessageNoEscapeRetID $chan (cembed "title" "loading...")}}\n{{$ID =joinStr "" $chan .}}{{$giveawaySdict:=sdict "chan" $chan "count" 0 "ID" $ID "listID" "" "maxWinners" $maxW "maxParticipants" $maxP "expiresAt" (currentTime.Add $duration) "prize" $prize "uID" $uID "host" $.User.Mention}}\n{{addMessageReactions $chan . $rEmoji}}{{$desc:=print `>>> **Prize : **` $prize "\\n\\n"}}\n{{if gt $maxW 0}}{{$desc =print $desc "**Max Winners :** " $maxW}}{{end}}{{if gt $maxP 0}}{{$desc =print $desc "\u2800\u2800\u2800\u2800\u2800**Max Participants :** " $maxP}}{{end}}\n{{$desc =print $desc "\\n\\n**Hosted By :** " $.User.Mention "\\n\\n**React with " $gEmoji " to enter GiveAway **"}}{{editMessage $chan . (cembed "title" "\ud83c\udf1f\ud83c\udf1f**GiveAway Started !!**\ud83c\udf1f\ud83c\udf1f" "description" $desc "color" 16763170 "footer" (sdict "text" (print "ID: " $uID " | GiveAway Ends ")) "timestamp" $giveawaySdict.expiresAt)}}\n\n{{$dbData:=sdict (or (dbGet 7777 "giveaway_active").Value sdict)}}{{$dbData.Set $ID $giveawaySdict}}{{dbSet 7777 "giveaway_active" $dbData}}\n{{$dbData =sdict (or (dbGet 7777 "giveaway_active_IDs").Value sdict)}}{{$dbData.Set (str $uID) $ID}}{{dbSet 7777 "giveaway_active_IDs" $dbData}}\n{{scheduleUniqueCC $.CCID $chan $duration.Seconds $uID $ID}}\n\n{{else}}\n**Invalid Channel !!**\n{{end}}\n{{else}}\n**Error:** Max Winners cannot be more than Max Participants!!\n{{end}}\n{{else}}\n**Error:** Invalid Duration or Prize !!\n{{end}}\n\n{{else if eq $subCmd "end"}}\n{{$uID:=index $CmdArgs 1}}\n{{with (dbGet 7777 "giveaway_active").Value}}\n{{$ID:=index (dbGet 7777 "giveaway_active_IDs").Value $uID}}\n{{with (index . (str $ID))}}{{cancelScheduledUniqueCC $.CCID .uID}}{{$s:=sendTemplate .chan "g_end" "ID" (str $ID)}}\n\n{{else}}\n**Error:** Invalid ID ``{{$uID}}``\n{{end}}\n{{else}}\n**Error:** No Active Giveaways.\n{{end}}\n\n{{else if eq $subCmd "cancel"}}\n{{$uID:=index $CmdArgs 1}}{{$ID:=0}}\n\n{{with (dbGet 7777 "giveaway_active").Value}}\n{{$dbID:=(dbGet 7777 "giveaway_active_IDs").Value}}{{$ID =index $dbID $uID}}\n\n{{with index . (str $ID)}}\n{{$chan:=.chan}}{{$prize:=.prize}}{{$host:=.host}}{{cancelScheduledUniqueCC $.CCID .uID}}{{$msg:=index (split $ID (str $chan)) 1}}\n{{with getMessage $chan $msg}}{{editMessage $chan $msg (cembed "title" "\ud83c\udf1f\ud83c\udf1f**GiveAway Cancelled !!**\ud83c\udf1f\ud83c\udf1f" "description" (print ">>> **Prize :** " $prize "\\n\\n**Hosted By : **" $host) "footer" (sdict "text" "Giveaway Cancelled") "color" 12257822)}}{{end}}Done!\n\n{{else}}\n**Error:** Invalid ID ``{{$uID}}``\n{{end}}\n\n{{if $ID}}\n{{$newdbData:=sdict .}}{{$newdbData.Del $ID}}{{dbSet 7777 "giveaway_active" $newdbData}}\n{{$newdbData =sdict $dbID}}{{$newdbData.Del $uID}}{{dbSet 7777 "giveaway_active_IDs" $newdbData}}\n{{end}}\n\n{{else}}\n**Error:** No Active Giveaways.\n{{end}}\n\n{{else if eq $subCmd "reroll"}}\n{{$ID:=1}}\n{{if gt (len $CmdArgs) 1}}{{$ID =toInt (index $CmdArgs 1)}}{{end}}{{$found:=false}}\n\n{{if ($e:=(dbGet 7777 "giveaway_old").Value)}}\n{{range $i,$v:=$e}}{{if or (eq (sub (len $e) $i) $ID) (eq (toInt $v.uID) $ID)}}{{$found =true}}{{$s:=sendTemplate $v.chan "g_end" "ID" (str $v.ID) "Data" $v}}{{end}}\n{{end}}\n{{if not $found}}**Error** - Invalid Argument `{{index $CmdArgs 1}}`. Old Giveaway with corresponding ID or Position(1-10) not found!{{end}}\n\n{{else}}\n**Error:** No Old Giveaways.\n{{end}}\n\n{{else if eq $subCmd "list"}}\n\n{{with (dbGet 7777 "giveaway_active").Value}}\n{{$count:=0}}\n{{range $k,$v:=.}}{{$count =add $count 1}}\n{{$count}}) **ID:** ``{{$v.uID}}``  **Prize:** ``{{$v.prize}}``\n**Ends AT:** ``{{formatTime $v.expiresAt}}``\n{{end}}\n\n{{else}}\nNo Active Giveaways.\n{{end}}\n\n{{else}}\n{{$syntaxError =1}}\n{{end}}\n{{else}}\n{{$syntaxError =1}}\n{{end}}\n{{else}}\n{{$syntaxError =1}}\n{{end}}\n\n{{else}}\n{{$s:=sendTemplate nil "g_end" "ID" $ExecData}}\n{{end}}\n\n{{define "g_end"}}\n{{$ID:=.TemplateArgs.ID}}{{$dbData:=(dbGet 7777 "giveaway_active").Value}}{{with .TemplateArgs.Data}}{{$dbData =sdict (str $ID) .}}{{end}}{{$chan:=(index $dbData $ID).chan}}\n\n{{if $dbData}}\n{{with index $dbData $ID}}\n{{$countWinners:=toInt .maxWinners}}{{$count:=toInt .count}}\n\n{{if lt $count $countWinners}}{{$countWinners =$count}}{{end}}\n{{$msg:=index (split $ID (str $chan)) 1}}{{$listID:=.listID}}\n\n{{if and (gt $count .maxParticipants) (gt .maxParticipants 0)}}{{$count =.maxParticipants}}{{$listID =joinStr "," (slice (split $listID ",") 0 $count) ""}}{{end}}\n\n{{$winnerList:=""}}\n{{range seq 0 $countWinners}}{{$winner:=index (split $listID ",") (randInt 0 $count)}}{{$listID =reReplace (print $winner ",") $listID ""}}{{$count =add $count -1}}{{$winnerList =(print $winnerList "<@" $winner "> ")}}{{end}}\n\n{{$desc:=print ">>> **Prize :** " .prize "\\n\\n**Winners :** "}}\n{{if $countWinners}}{{$desc =print $desc $winnerList}}{{else}}{{$desc =print $desc "No Participants :( "}}{{end}}\n{{$desc:=print $desc "\\n\\n**Hosted By :** " .host}}\n{{with getMessage $chan $msg}}{{editMessage $chan $msg (cembed "title" "\ud83c\udf1f\ud83c\udf1f**GiveAway Ended !!**\ud83c\udf1f\ud83c\udf1f" "description" $desc "footer" (sdict "text" "Giveaway Ended at ") "timestamp" currentTime "color" 12257822)}}{{end}}\n\n{{if $countWinners}}{{sendMessage nil (print "**Prize :** " .prize "\\n**Winner(s) :** " $winnerList)}}\n{{else}}\n**Giveaway Ended, No participants :( !!**\n**Prize : {{.prize}}**\n{{end}}\n\n{{if not $.TemplateArgs.Data}}\n{{$newdbData:=sdict $dbData}}{{$newdbData.Del $ID}}{{dbSet 7777 "giveaway_active" $newdbData}}\n{{$newdbData =sdict (dbGet 7777 "giveaway_active_IDs").Value}}{{$newdbData.Del (str .uID)}}{{dbSet 7777 "giveaway_active_IDs" $newdbData}}\n{{$old:=cslice.AppendSlice (or (dbGet 7777 "giveaway_old").Value cslice)}}{{if gt (len $old) 9}}{{$old =slice $old 1}}{{end}}{{dbSet 7777 "giveaway_old" ($old.Append .)}}\n{{end}}\n\n{{else}}`Warning:` Invoked CC : {{$.CCID}} using ExecCC with invalid Giveaway ID.\n{{end}}\n{{else}}`Warning:` Invoked CC : {{$.CCID}} using ExecCC with no active Giveaways.\n{{end}}\n\n{{end}}\n\n{{if $syntaxError}}{{sendMessage nil (print "__**Incorrect Syntax** __ \\n**Commands are :** \\n```elm\\n" ($Cmd) " start <time : Duration> <prize : String> \\n\\noptional_flags \\n-p (max participants : Number) \\n-w (max winners : Number)\\n-c (channel : Mention/ID)\\n```\\n```elm\\n" ($Cmd) " end <id : Number>```\\n```elm\\n" ($Cmd) " cancel <id : Number>```\\n```elm\\n" ($Cmd) " reroll [id or n giveaways old : Number]```\\n```elm\\n" ($Cmd) " list ``` ")}}{{end}}\n')))}p.isMDXComponent=!0}}]);